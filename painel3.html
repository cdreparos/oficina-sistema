<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Painel - SIGO Casa dos Reparos</title>
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: #f0f2f5;
      min-height: 100vh;
    }

    /* Header */
    header {
      background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
      color: white;
      padding: 24px 32px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .header-content {
      max-width: 1600px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .logo {
      width: 48px;
      height: 48px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
    }

    .header-info h1 {
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 2px;
    }

    .header-info p {
      font-size: 0.85rem;
      opacity: 0.9;
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 12px;
      background: rgba(255, 255, 255, 0.15);
      padding: 8px 16px;
      border-radius: 10px;
    }

    .user-avatar {
      width: 36px;
      height: 36px;
      background: rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 0.85rem;
    }

    .user-details {
      display: flex;
      flex-direction: column;
    }

    .user-name {
      font-size: 0.9rem;
      font-weight: 600;
    }

    .user-email {
      font-size: 0.75rem;
      opacity: 0.85;
    }

    .header-btn {
      width: 40px;
      height: 40px;
      background: rgba(255, 255, 255, 0.15);
      border: none;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s;
      position: relative;
      color: white;
      font-size: 1.2rem;
    }

    .header-btn:hover {
      background: rgba(255, 255, 255, 0.25);
      transform: translateY(-2px);
    }

    .notification-badge {
      position: absolute;
      top: -4px;
      right: -4px;
      background: #ef4444;
      color: white;
      border-radius: 50%;
      min-width: 20px;
      height: 20px;
      font-size: 0.65rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 2px solid #3b82f6;
    }

    /* Main Container */
    .container {
      max-width: 1600px;
      margin: 0 auto;
      padding: 24px 32px;
    }

    /* Quick Actions Bar */
    .quick-actions {
      background: white;
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 24px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
    }

    .quick-actions-title {
      font-size: 1.1rem;
      font-weight: 600;
      color: #1f2937;
      margin-bottom: 16px;
    }

    .action-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 12px;
    }

    .action-btn {
      background: #f9fafb;
      border: 2px solid #e5e7eb;
      border-radius: 12px;
      padding: 16px;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      text-decoration: none;
      color: #374151;
    }

    .action-btn:hover {
      background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
      color: white;
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(59, 130, 246, 0.3);
      border-color: transparent;
    }

    .action-btn-icon {
      font-size: 1.5rem;
    }

    .action-btn-label {
      font-size: 0.85rem;
      font-weight: 600;
      text-align: center;
    }

    /* Priority Cards Grid */
    .priority-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 20px;
      margin-bottom: 24px;
    }

    .card {
      background: white;
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
      border: 1px solid #e5e7eb;
      transition: all 0.3s;
      cursor: pointer;
      position: relative;
      overflow: hidden;
    }

    .card:hover {
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
      transform: translateY(-4px);
    }

    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
    }

    .card-anotacoes::before { background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); }
    .card-contas::before { background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); }
    .card-agenda::before { background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); }
    .card-pecas::before { background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%); }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 16px;
    }

    .card-title {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .card-icon {
      width: 40px;
      height: 40px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.3rem;
    }

    .card-anotacoes .card-icon { background: rgba(245, 158, 11, 0.1); }
    .card-contas .card-icon { background: rgba(239, 68, 68, 0.1); }
    .card-agenda .card-icon { background: rgba(139, 92, 246, 0.1); }
    .card-pecas .card-icon { background: rgba(6, 182, 212, 0.1); }

    .card-name {
      font-size: 1.1rem;
      font-weight: 600;
      color: #1f2937;
    }

    .card-badge {
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 700;
      background: #dbeafe;
      color: #1e40af;
    }

    .card-description {
      color: #6b7280;
      font-size: 0.85rem;
      margin-bottom: 16px;
    }

    .card-items {
      display: flex;
      flex-direction: column;
      gap: 8px;
      max-height: 150px;
      overflow-y: auto;
    }

    .card-item {
      padding: 10px 12px;
      background: #f9fafb;
      border-radius: 8px;
      font-size: 0.85rem;
      color: #374151;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: all 0.2s;
    }

    .card-item:hover {
      background: #f3f4f6;
      transform: translateX(4px);
    }

    .card-item-meta {
      font-size: 0.75rem;
      color: #9ca3af;
    }

    .card-empty {
      text-align: center;
      padding: 30px;
      color: #9ca3af;
      font-size: 0.85rem;
    }

    /* Dashboard Financeiro */
    .financial-dashboard {
      background: white;
      border-radius: 16px;
      padding: 24px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
      margin-bottom: 24px;
    }

    .dashboard-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 2px solid #f3f4f6;
    }

    .dashboard-title {
      font-size: 1.3rem;
      font-weight: 700;
      color: #1f2937;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .dashboard-period {
      display: flex;
      gap: 8px;
    }

    .period-btn {
      padding: 8px 16px;
      border: 1px solid #e5e7eb;
      background: white;
      border-radius: 8px;
      font-size: 0.85rem;
      cursor: pointer;
      transition: all 0.3s;
      color: #6b7280;
    }

    .period-btn.active {
      background: #3b82f6;
      color: white;
      border-color: #3b82f6;
    }

    /* Stats Grid */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin-bottom: 24px;
    }

    .stat-box {
      background: #f9fafb;
      border-radius: 12px;
      padding: 16px;
      border-left: 4px solid #3b82f6;
    }

    .stat-box.income { border-left-color: #10b981; }
    .stat-box.expense { border-left-color: #ef4444; }
    .stat-box.profit { border-left-color: #8b5cf6; }
    .stat-box.pending { border-left-color: #f59e0b; }

    .stat-label {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.85rem;
      color: #6b7280;
      margin-bottom: 8px;
    }

    .stat-value {
      font-size: 1.5rem;
      font-weight: 800;
      color: #1f2937;
    }

    .stat-change {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-size: 0.75rem;
      font-weight: 600;
      margin-top: 4px;
      padding: 2px 8px;
      border-radius: 12px;
    }

    .stat-change.positive {
      color: #10b981;
      background: rgba(16, 185, 129, 0.1);
    }

    .stat-change.negative {
      color: #ef4444;
      background: rgba(239, 68, 68, 0.1);
    }

    /* Charts Container */
    .charts-container {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 20px;
      margin-top: 24px;
    }

    .chart-box {
      background: #f9fafb;
      border-radius: 12px;
      padding: 20px;
    }

    .chart-title {
      font-size: 1rem;
      font-weight: 600;
      color: #374151;
      margin-bottom: 16px;
    }

    .chart-placeholder {
      height: 200px;
      background: linear-gradient(135deg, #e5e7eb 0%, #f3f4f6 100%);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #9ca3af;
    }

    /* Recent Transactions */
    .recent-transactions {
      margin-top: 20px;
    }

    .transactions-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .transactions-title {
      font-size: 1rem;
      font-weight: 600;
      color: #374151;
    }

    .view-all-link {
      color: #3b82f6;
      font-size: 0.85rem;
      text-decoration: none;
      font-weight: 600;
      transition: all 0.3s;
    }

    .view-all-link:hover {
      text-decoration: underline;
    }

    .transactions-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .transaction-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px;
      background: white;
      border-radius: 8px;
      border: 1px solid #e5e7eb;
      transition: all 0.2s;
    }

    .transaction-item:hover {
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }

    .transaction-info {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .transaction-icon {
      width: 36px;
      height: 36px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1rem;
    }

    .transaction-icon.income {
      background: rgba(16, 185, 129, 0.1);
      color: #10b981;
    }

    .transaction-icon.expense {
      background: rgba(239, 68, 68, 0.1);
      color: #ef4444;
    }

    .transaction-details {
      display: flex;
      flex-direction: column;
    }

    .transaction-name {
      font-size: 0.9rem;
      font-weight: 600;
      color: #1f2937;
    }

    .transaction-date {
      font-size: 0.75rem;
      color: #9ca3af;
    }

    .transaction-amount {
      font-weight: 700;
      font-size: 0.95rem;
    }

    .transaction-amount.income {
      color: #10b981;
    }

    .transaction-amount.expense {
      color: #ef4444;
    }

    /* Footer */
    footer {
      background: white;
      border-top: 1px solid #e5e7eb;
      padding: 20px 32px;
      display: flex;
      justify-content: center;
      gap: 12px;
    }

    .footer-btn {
      background: #f3f4f6;
      color: #1f2937;
      border: none;
      padding: 10px 20px;
      border-radius: 10px;
      font-weight: 600;
      font-size: 0.85rem;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .footer-btn:hover {
      background: #3b82f6;
      color: white;
      transform: translateY(-2px);
    }

    /* Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.6);
      z-index: 1000;
      padding: 20px;
    }

    .modal.active {
      display: block;
    }

    .modal-content {
      background: white;
      border-radius: 20px;
      padding: 32px;
      max-width: 700px;
      margin: 40px auto;
    }

    /* Responsividade */
    @media (max-width: 1024px) {
      .priority-cards {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .charts-container {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 768px) {
      .container {
        padding: 16px;
      }

      .header-content {
        flex-direction: column;
        gap: 16px;
      }

      .priority-cards {
        grid-template-columns: 1fr;
      }

      .action-buttons {
        grid-template-columns: repeat(2, 1fr);
      }

      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
      }

      footer {
        flex-wrap: wrap;
      }

      .footer-btn {
        flex: 1;
        min-width: 120px;
      }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header>
    <div class="header-content">
      <div class="header-left">
        <div class="logo">üîß</div>
        <div class="header-info">
          <h1>SIGO Casa dos Reparos</h1>
          <p>Sistema Integrado de Gerenciamento de Oficina</p>
        </div>
      </div>
      <div class="header-right">
        <div class="user-info">
          <div class="user-avatar" id="userAvatar">U</div>
          <div class="user-details">
            <div class="user-name" id="userName">Carregando...</div>
            <div class="user-email" id="userEmail">...</div>
          </div>
        </div>
        <button class="header-btn" id="btnNotificacoes">
          üîî
          <span class="notification-badge" id="notificationBadge" style="display: none;">0</span>
        </button>
        <button class="header-btn" id="btnConfiguracoes">‚öôÔ∏è</button>
      </div>
    </div>
  </header>

  <!-- Main Container -->
  <div class="container">
    <!-- Quick Actions Bar -->
    <div class="quick-actions">
      <h2 class="quick-actions-title">Acesso R√°pido</h2>
      <div class="action-buttons">
        <a href="ordens-servico.html" class="action-btn">
          <span class="action-btn-icon">üõ†Ô∏è</span>
          <span class="action-btn-label">Ordens de Servi√ßo</span>
        </a>
        <a href="clientes.html" class="action-btn">
          <span class="action-btn-icon">üë•</span>
          <span class="action-btn-label">Clientes</span>
        </a>
        <a href="estoque.html" class="action-btn">
          <span class="action-btn-icon">üì¶</span>
          <span class="action-btn-label">Estoque</span>
        </a>
        <a href="contas_financeiro.html" class="action-btn">
          <span class="action-btn-icon">üí∞</span>
          <span class="action-btn-label">Financeiro Completo</span>
        </a>
      </div>
    </div>

    <!-- Priority Cards -->
    <div class="priority-cards">
      <!-- Anota√ß√µes -->
      <div class="card card-anotacoes" onclick="window.location.href='anotacoes.html'">
        <div class="card-header">
          <div class="card-title">
            <div class="card-icon">üìù</div>
            <span class="card-name">Anota√ß√µes</span>
          </div>
          <span class="card-badge" id="badge-anotacoes">0</span>
        </div>
        <p class="card-description">Lembretes e anota√ß√µes importantes</p>
        <div class="card-items" id="lista-anotacoes">
          <div class="card-empty">Nenhuma anota√ß√£o</div>
        </div>
      </div>

      <!-- Contas a Pagar -->
      <div class="card card-contas" onclick="window.location.href='contas_financeiro.html'">
        <div class="card-header">
          <div class="card-title">
            <div class="card-icon">üí∏</div>
            <span class="card-name">Contas a Pagar</span>
          </div>
          <span class="card-badge" id="badge-contas">0</span>
        </div>
        <p class="card-description">Contas pendentes e vencimentos</p>
        <div class="card-items" id="lista-contas">
          <div class="card-empty">Sem contas pendentes</div>
        </div>
      </div>

      <!-- Agenda -->
      <div class="card card-agenda" onclick="window.location.href='agendamentos.html'">
        <div class="card-header">
          <div class="card-title">
            <div class="card-icon">üìÖ</div>
            <span class="card-name">Agenda</span>
          </div>
          <span class="card-badge" id="badge-agenda">0</span>
        </div>
        <p class="card-description">Pr√≥ximos agendamentos</p>
        <div class="card-items" id="lista-agendamentos">
          <div class="card-empty">Sem agendamentos</div>
        </div>
      </div>

      <!-- Pe√ßas para Pedir -->
      <div class="card card-pecas" onclick="window.location.href='pecas.html'">
        <div class="card-header">
          <div class="card-title">
            <div class="card-icon">üî©</div>
            <span class="card-name">Pe√ßas para Pedir</span>
          </div>
          <span class="card-badge" id="badge-pecas">0</span>
        </div>
        <p class="card-description">Solicita√ß√µes pendentes</p>
        <div class="card-items" id="lista-pecas">
          <div class="card-empty">Sem pe√ßas pendentes</div>
        </div>
      </div>
    </div>

    <!-- Dashboard Financeiro -->
    <div class="financial-dashboard">
      <div class="dashboard-header">
        <h2 class="dashboard-title">
          <span>üìä</span>
          <span>Dashboard Financeiro</span>
        </h2>
        <div class="dashboard-period">
          <button class="period-btn" data-period="dia">Hoje</button>
          <button class="period-btn" data-period="semana">Semana</button>
          <button class="period-btn active" data-period="mes">M√™s</button>
          <button class="period-btn" data-period="ano">Ano</button>
        </div>
      </div>

      <!-- Stats Grid -->
      <div class="stats-grid">
        <div class="stat-box income">
          <div class="stat-label">
            <span>üíµ</span>
            <span>Receitas</span>
          </div>
          <div class="stat-value" id="stat-receitas">R$ 0,00</div>
          <span class="stat-change positive">‚Üë 15% vs per√≠odo anterior</span>
        </div>

        <div class="stat-box expense">
          <div class="stat-label">
            <span>üí∏</span>
            <span>Despesas</span>
          </div>
          <div class="stat-value" id="stat-despesas">R$ 0,00</div>
          <span class="stat-change negative">‚Üë 5% vs per√≠odo anterior</span>
        </div>

        <div class="stat-box profit">
          <div class="stat-label">
            <span>üí∞</span>
            <span>Lucro L√≠quido</span>
          </div>
          <div class="stat-value" id="stat-lucro">R$ 0,00</div>
          <span class="stat-change positive">‚Üë 20% vs per√≠odo anterior</span>
        </div>

        <div class="stat-box pending">
          <div class="stat-label">
            <span>‚è∞</span>
            <span>A Receber</span>
          </div>
          <div class="stat-value" id="stat-receber">R$ 0,00</div>
          <span class="stat-change">5 pendentes</span>
        </div>
      </div>

      <!-- Charts -->
      <div class="charts-container">
        <div class="chart-box">
          <h3 class="chart-title">Fluxo de Caixa - √öltimos 7 dias</h3>
          <div class="chart-placeholder">
            üìà Gr√°fico de Fluxo de Caixa
          </div>
        </div>

        <div class="chart-box">
          <h3 class="chart-title">Distribui√ß√£o de Gastos</h3>
          <div class="chart-placeholder">
            üçï Gr√°fico de Pizza
          </div>
        </div>
      </div>

      <!-- Recent Transactions -->
      <div class="recent-transactions">
        <div class="transactions-header">
          <h3 class="transactions-title">√öltimas Transa√ß√µes</h3>
          <a href="contas_financeiro.html" class="view-all-link">Ver todas ‚Üí</a>
        </div>
        <div class="transactions-list" id="transactions-list">
          <div class="transaction-item">
            <div class="transaction-info">
              <div class="transaction-icon income">‚Üì</div>
              <div class="transaction-details">
                <span class="transaction-name">OS #0045 - Jo√£o Silva</span>
                <span class="transaction-date">Hoje, 14:30</span>
              </div>
            </div>
            <span class="transaction-amount income">+ R$ 450,00</span>
          </div>
          
          <div class="transaction-item">
            <div class="transaction-info">
              <div class="transaction-icon expense">‚Üë</div>
              <div class="transaction-details">
                <span class="transaction-name">Compra de Pe√ßas</span>
                <span class="transaction-date">Hoje, 10:15</span>
              </div>
            </div>
            <span class="transaction-amount expense">- R$ 280,00</span>
          </div>
          
          <div class="transaction-item">
            <div class="transaction-info">
              <div class="transaction-icon income">‚Üì</div>
              <div class="transaction-details">
                <span class="transaction-name">OS #0044 - Maria Santos</span>
                <span class="transaction-date">Ontem, 16:45</span>
              </div>
            </div>
            <span class="transaction-amount income">+ R$ 320,00</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer>
    <button class="footer-btn" id="btnBackup">üíæ Backup</button>
    <button class="footer-btn" id="btnRelatorios">üìä Relat√≥rios</button>
    <button class="footer-btn" id="btnConfig">‚öôÔ∏è Configura√ß√µes</button>
    <button class="footer-btn" id="btnSair">üö™ Sair</button>
  </footer>

  <!-- Scripts -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <script src="firebase-config.js"></script>
  <script src="utils.js"></script>

  <script>
    // Proteger p√°gina
    protegerPagina();

    // Refer√™ncias do Firebase
    const refs = {
      anotacoes: database.ref("anotacoes"),
      agendamentos: database.ref("agendamentos"),
      pecasPedir: database.ref("pecas_pedir"),
      transacoes: database.ref("transacoes"),
      os: database.ref("ordens_servico"),
      estoque: database.ref("estoque"),
      clientes: database.ref("clientes")
    };

    let dados = {};

    // Carregar informa√ß√µes do usu√°rio
    auth.onAuthStateChanged(user => {
      if (user) {
        const nome = user.displayName || user.email.split('@')[0];
        const iniciais = nome.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase();
        document.getElementById('userName').textContent = nome;
        document.getElementById('userEmail').textContent = user.email;
        document.getElementById('userAvatar').textContent = iniciais;
      }
    });

    // Listener para cada refer√™ncia
    Object.keys(refs).forEach(key => {
      refs[key].on("value", snapshot => {
        dados[key] = snapshot.val() || {};
        atualizarDashboard();
      });
    });

    // Atualizar dashboard
    function atualizarDashboard() {
      // ANOTA√á√ïES
      const anotacoesArray = Object.values(dados.anotacoes || {})
        .filter(a => !a.arquivada)
        .slice(0, 5);
      
      document.getElementById('badge-anotacoes').textContent = anotacoesArray.length;
      const listaAnotacoes = document.getElementById('lista-anotacoes');
      
      if (anotacoesArray.length === 0) {
        listaAnotacoes.innerHTML = '<div class="card-empty">Nenhuma anota√ß√£o</div>';
      } else {
        listaAnotacoes.innerHTML = '';
        anotacoesArray.forEach(anotacao => {
          const item = document.createElement('div');
          item.className = 'card-item';
          item.innerHTML = `
            <span>${anotacao.texto.substring(0, 50)}${anotacao.texto.length > 50 ? '...' : ''}</span>
            <span class="card-item-meta">${formatarDataRelativa(anotacao.criadoEm)}</span>
          `;
          listaAnotacoes.appendChild(item);
        });
      }

      // CONTAS A PAGAR
      const hoje = new Date();
      const contasArray = Object.values(dados.transacoes || {})
        .filter(t => t.tipo === 'saida' && t.statusTransacao === 'pendente')
        .slice(0, 5);
      
      document.getElementById('badge-contas').textContent = contasArray.length;
      const listaContas = document.getElementById('lista-contas');
      
      if (contasArray.length === 0) {
        listaContas.innerHTML = '<div class="card-empty">Sem contas pendentes</div>';
      } else {
        listaContas.innerHTML = '';
        contasArray.forEach(conta => {
          const vencimento = conta.dataVencimento ? new Date(conta.dataVencimento) : null;
          const vencido = vencimento && vencimento < hoje;
          
          const item = document.createElement('div');
          item.className = 'card-item';
          item.innerHTML = `
            <span>${conta.descricao.substring(0, 30)}${conta.descricao.length > 30 ? '...' : ''}</span>
            <span class="card-item-meta" style="color: ${vencido ? '#ef4444' : '#9ca3af'}">
              R$ ${formatarMoeda(conta.valor).replace('R$ ', '')}
            </span>
          `;
          listaContas.appendChild(item);
        });
      }

      // AGENDA
      const agendamentosArray = Object.values(dados.agendamentos || {})
        .filter(ag => new Date(ag.dataAgendamento) >= hoje)
        .sort((a, b) => new Date(a.dataAgendamento) - new Date(b.dataAgendamento))
        .slice(0, 5);
      
      document.getElementById('badge-agenda').textContent = agendamentosArray.length;
      const listaAgendamentos = document.getElementById('lista-agendamentos');
      
      if (agendamentosArray.length === 0) {
        listaAgendamentos.innerHTML = '<div class="card-empty">Sem agendamentos</div>';
      } else {
        listaAgendamentos.innerHTML = '';
        agendamentosArray.forEach(ag => {
          const item = document.createElement('div');
          item.className = 'card-item';
          item.innerHTML = `
            <span>${ag.clienteNome} - ${ag.tipoServico || 'Servi√ßo'}</span>
            <span class="card-item-meta">
              ${formatarData(ag.dataAgendamento)} ${ag.horaAgendamento}
            </span>
          `;
          listaAgendamentos.appendChild(item);
        });
      }

      // PE√áAS PARA PEDIR
      const pecasArray = Object.values(dados.pecasPedir || {})
        .filter(p => p.statusPeca === 'pendente')
        .sort((a, b) => (a.prioridade === 'urgente' ? -1 : 1))
        .slice(0, 5);
      
      document.getElementById('badge-pecas').textContent = pecasArray.length;
      const listaPecas = document.getElementById('lista-pecas');
      
      if (pecasArray.length === 0) {
        listaPecas.innerHTML = '<div class="card-empty">Sem pe√ßas pendentes</div>';
      } else {
        listaPecas.innerHTML = '';
        pecasArray.forEach(peca => {
          const item = document.createElement('div');
          item.className = 'card-item';
          const corPrioridade = peca.prioridade === 'urgente' ? '#ef4444' : '#9ca3af';
          item.innerHTML = `
            <span>${peca.nomePeca}</span>
            <span class="card-item-meta" style="color: ${corPrioridade}">
              ${peca.prioridade === 'urgente' ? '‚ö†Ô∏è ' : ''}${peca.prioridade}
            </span>
          `;
          listaPecas.appendChild(item);
        });
      }

      // DASHBOARD FINANCEIRO
      atualizarDashboardFinanceiro();

      // NOTIFICA√á√ïES
      const estoqueArray = Object.values(dados.estoque || {})
        .filter(item => item.quantidade <= item.estoqueMinimo);
      const agendamentosHoje = Object.values(dados.agendamentos || {})
        .filter(ag => new Date(ag.dataAgendamento).toDateString() === new Date().toDateString()).length;
      
      const totalNotif = estoqueArray.length + agendamentosHoje + contasArray.length;
      
      if (totalNotif > 0) {
        document.getElementById('notificationBadge').style.display = 'flex';
        document.getElementById('notificationBadge').textContent = totalNotif;
      } else {
        document.getElementById('notificationBadge').style.display = 'none';
      }
    }

    // Atualizar Dashboard Financeiro
    let periodoSelecionado = 'mes';

    function atualizarDashboardFinanceiro() {
      const hoje = new Date();
      const transacoesArray = Object.values(dados.transacoes || {});
      
      let dataInicio, dataFim;
      
      // Definir per√≠odo
      switch(periodoSelecionado) {
        case 'dia':
          dataInicio = new Date(hoje);
          dataInicio.setHours(0, 0, 0, 0);
          dataFim = new Date(hoje);
          dataFim.setHours(23, 59, 59, 999);
          break;
        case 'semana':
          dataInicio = new Date(hoje);
          dataInicio.setDate(hoje.getDate() - 7);
          dataFim = hoje;
          break;
        case 'mes':
          dataInicio = new Date(hoje.getFullYear(), hoje.getMonth(), 1);
          dataFim = new Date(hoje.getFullYear(), hoje.getMonth() + 1, 0);
          break;
        case 'ano':
          dataInicio = new Date(hoje.getFullYear(), 0, 1);
          dataFim = new Date(hoje.getFullYear(), 11, 31);
          break;
      }

      // Filtrar transa√ß√µes do per√≠odo
      const transacoesPeriodo = transacoesArray.filter(t => {
        const data = new Date(t.dataTransacao);
        return data >= dataInicio && data <= dataFim;
      });

      // Calcular valores
      const receitas = transacoesPeriodo
        .filter(t => t.tipo === 'entrada' && t.statusTransacao === 'pago')
        .reduce((sum, t) => sum + parseFloat(t.valor), 0);
      
      const despesas = transacoesPeriodo
        .filter(t => t.tipo === 'saida' && t.statusTransacao === 'pago')
        .reduce((sum, t) => sum + parseFloat(t.valor), 0);
      
      const lucro = receitas - despesas;
      
      const aReceber = transacoesArray
        .filter(t => t.tipo === 'entrada' && t.statusTransacao === 'pendente')
        .reduce((sum, t) => sum + parseFloat(t.valor), 0);

      // Atualizar valores na tela
      document.getElementById('stat-receitas').textContent = formatarMoeda(receitas);
      document.getElementById('stat-despesas').textContent = formatarMoeda(despesas);
      document.getElementById('stat-lucro').textContent = formatarMoeda(lucro);
      document.getElementById('stat-receber').textContent = formatarMoeda(aReceber);

      // Atualizar √∫ltimas transa√ß√µes
      const ultimasTransacoes = transacoesArray
        .sort((a, b) => new Date(b.dataTransacao) - new Date(a.dataTransacao))
        .slice(0, 3);
      
      const listaTrans = document.getElementById('transactions-list');
      listaTrans.innerHTML = '';
      
      ultimasTransacoes.forEach(trans => {
        const item = document.createElement('div');
        item.className = 'transaction-item';
        const tipo = trans.tipo === 'entrada' ? 'income' : 'expense';
        const sinal = trans.tipo === 'entrada' ? '+' : '-';
        
        item.innerHTML = `
          <div class="transaction-info">
            <div class="transaction-icon ${tipo}">${trans.tipo === 'entrada' ? '‚Üì' : '‚Üë'}</div>
            <div class="transaction-details">
              <span class="transaction-name">${trans.descricao}</span>
              <span class="transaction-date">${formatarDataHora(trans.dataTransacao)}</span>
            </div>
          </div>
          <span class="transaction-amount ${tipo}">${sinal} ${formatarMoeda(trans.valor)}</span>
        `;
        listaTrans.appendChild(item);
      });
    }

    // Fun√ß√µes auxiliares
    function formatarDataRelativa(data) {
      if (!data) return '';
      const agora = new Date();
      const dataObj = new Date(data);
      const diff = agora - dataObj;
      const dias = Math.floor(diff / (1000 * 60 * 60 * 24));
      
      if (dias === 0) return 'Hoje';
      if (dias === 1) return 'Ontem';
      if (dias < 7) return `${dias} dias atr√°s`;
      return dataObj.toLocaleDateString('pt-BR');
    }

    function formatarDataHora(data) {
      if (!data) return '';
      const dataObj = new Date(data);
      const hoje = new Date();
      
      if (dataObj.toDateString() === hoje.toDateString()) {
        return `Hoje, ${dataObj.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' })}`;
      }
      
      const ontem = new Date(hoje);
      ontem.setDate(hoje.getDate() - 1);
      if (dataObj.toDateString() === ontem.toDateString()) {
        return `Ontem, ${dataObj.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' })}`;
      }
      
      return dataObj.toLocaleDateString('pt-BR') + ', ' + 
             dataObj.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
    }

    // Event listeners para per√≠odo
    document.querySelectorAll('.period-btn').forEach(btn => {
      btn.addEventListener('click', function() {
        document.querySelectorAll('.period-btn').forEach(b => b.classList.remove('active'));
        this.classList.add('active');
        periodoSelecionado = this.dataset.period;
        atualizarDashboardFinanceiro();
      });
    });

    // Bot√µes do footer
    document.getElementById('btnSair').onclick = logout;

    document.getElementById('btnBackup').onclick = () => {
      const backup = {
        data: new Date().toISOString(),
        dados: dados
      };
      const blob = new Blob([JSON.stringify(backup, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `backup-sigo-${new Date().toISOString().split('T')[0]}.json`;
      a.click();
      URL.revokeObjectURL(url);
      alert('Backup realizado com sucesso!');
    };

    document.getElementById('btnRelatorios').onclick = () => {
      alert('Sistema de relat√≥rios em desenvolvimento...');
    };

    document.getElementById('btnConfig').onclick = () => {
      alert('Configura√ß√µes do sistema em desenvolvimento...');
    };

    console.log('Painel SIGO - Sistema carregado com sucesso!');
  </script>
